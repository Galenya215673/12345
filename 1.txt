import sympy as sp
from sympy.parsing.sympy_parser import parse_expr

def calculate_derivative(function_str):
    """
    Функция для вычисления дифференциала (первой производной) заданной функции.
    
    :param function_str: строка с функцией (например, 'x**3 + 2*x**2 + 3*x + 4').
    :return: кортеж с исходной функцией и её первой производной.
    """
    x = sp.symbols('x')
    
    try:
        # Используем парсер для преобразования строки в SymPy-выражение
        func_expr = parse_expr(function_str, local_dict={'x': x})
        
        # Первая производная функции
        derivative = sp.diff(func_expr, x)
        
        return func_expr, derivative
    
    except Exception as e:
        print(f"Ошибка при обработке функции: {e}")
        return None, None

if __name__ == "__main__":
    # Предложим пользователю правильный синтаксис ввода
    print("Пример правильного ввода функции: 'x**3 + 2*x**2 + 3*x + 4'")
    
    # Запрашиваем функцию у пользователя
    user_input = input("Введите функцию для вычисления её дифференциала: ")
    
    original_func, diff_result = calculate_derivative(user_input)
    
    if original_func and diff_result:
        # Красивое представление формул с помощью latex-визуализации
        print("\nИсходная функция:\n", sp.latex(original_func))
        print("Производная (дифференциал):\n", sp.latex(diff_result), "\n")
    else:
        print("Невозможно обработать вашу функцию.")